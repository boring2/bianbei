<style lang="less">
.topic-view {
  padding: 50rpx 20rpx;
}
.topic-wrap {
  display: flex;
  justify-content: space-around;
  align-items: center;
  padding: 80rpx 40rpx;
  border-radius: 20rpx;
  margin-bottom: 20rpx;
  color: white;
  .topic-title {
    font-size: 35rpx;
    width: 70%;
  }
  .topic-date {
    font-size: 20rpx;
    width: 30%;
    text-align:right;
  }
}

</style>
<template>
 <view class="topic-view">
    <repeat for="{{topics}}" key="index" index="index" item="topic">
      <view class="topic-wrap" @tap="tapTitle({{topic.objectId}})" style="background: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 1)), url({{topic.img}}) center / cover no-repeat;">
        <view class="topic-title">{{topic.content}}</view>
        <view class="topic-date">{{topic.createdAt}}</view>
      </view>
    </repeat>
  </view>
</template>

<script>
import wepy from 'wepy'
import api from '../utils/api'
import errorHandler from '../utils/error'

export default class Past extends wepy.page {
  config = {
    navigationBarTitleText: '编呗历史'
  }

  data = {
    topics: []
  }

  onLoad() {
    wx.showLoading({
      title: '正在加载...',
      mask: true
    })
    wx.showNavigationBarLoading()
    this.fetchTopics()
  }

  async fetchTopics () {
    try {
      let topics = await api.getTopics()
      this.topics = topics.data
      this.topics.map((topic) => {
        topic.createdAt = this._resolveDate(topic.createdAt)
      })
      this.$apply()
    } catch (err) {
      console.error('fetchTopics', err)
      errorHandler(err)
    }
  }

  _resolveDate (date) {
    return date.split('T')[0]
  }

  methods = {
    tapTitle (id) {
      let url = 'detail?id=' + id
      console.log(url)
      wx.navigateTo({
        url
      })
    }
  }
}
</script>
